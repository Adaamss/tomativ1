Merci pour le log dÃ©taillÃ© ğŸ™ Ã‡a me donne une bonne idÃ©e de ton problÃ¨me.
Il y a deux erreurs principales dans ce que tu montres :

1. URL invalide cÃ´tÃ© client
Failed to construct 'WebSocket': The URL 'wss://localhost:undefined/?token=ZQ9GyEmM4xA7' is invalid.


ğŸ‘‰ Ã‡a veut dire que ton code essaie de crÃ©er un WebSocket vers localhost:undefined.
Donc la variable oÃ¹ tu stockes lâ€™URL du serveur WebSocket nâ€™est pas correctement dÃ©finie (probablement une env var manquante ou mal passÃ©e dans le frontend).

VÃ©rifie dans ton useWebSocket.ts (ou ton setupWebSocket) que tu rÃ©cupÃ¨res bien lâ€™URL. Exemple :

const WS_URL = import.meta.env.VITE_WS_URL || "wss://your-domain/ws";
const ws = new WebSocket(`${WS_URL}?token=${token}`);


âš ï¸ Si VITE_WS_URL nâ€™est pas dÃ©fini, tu tombes sur localhost:undefined.

2. Port WebSocket non accessible sur Replit
WebSocket connection to 'wss://...replit.dev:5000/ws' failed


ğŸ‘‰ Sur Replit, tu ne peux pas exposer un port arbitraire (genre 5000).
Replit ne laisse accessible que le port par dÃ©faut (80/443).

Donc ton backend WebSocket doit :

tourner sur le mÃªme serveur que ton API (pas un autre port),

Ãªtre servi en upgrade HTTP â†’ WS sur /:path (ex: /ws).

Par exemple cÃ´tÃ© backend (Node.js / Express + ws) :

import express from "express";
import { WebSocketServer } from "ws";
import http from "http";

const app = express();
const server = http.createServer(app);

// Monte le serveur WS sur le mÃªme port
const wss = new WebSocketServer({ server, path: "/ws" });

wss.on("connection", (socket) => {
  console.log("Client connectÃ© !");
  socket.send("Bienvenue !");
});

server.listen(3000, () => {
  console.log("Serveur sur http://localhost:3000");
});


Et cÃ´tÃ© frontend :

const ws = new WebSocket("wss://<ton-app>.replit.dev/ws");


âœ… En rÃ©sumÃ© pour corriger :

Corrige lâ€™URL (pas de localhost:undefined, mais un vrai wss://...).

Nâ€™utilise pas :5000 sur Replit â†’ expose /ws sur le port par dÃ©faut de ton API.

Veux-tu que je tâ€™Ã©crive un exemple complet backend (Express + WS) + frontend (React hook) adaptÃ© Ã  ton code pour Replit ?